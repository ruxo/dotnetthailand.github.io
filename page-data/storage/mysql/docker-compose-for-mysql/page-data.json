{"componentChunkName":"component---src-templates-docs-js","path":"/storage/mysql/docker-compose-for-mysql","result":{"data":{"site":{"siteMetadata":{"title":".NET Thailand","docsLocation":"https://github.com/dotnetthailand/dotnetthailand.github.io","docsRepo":"dotnetthailand/dotnetthailand.github.io","docsLocationType":"github","editable":true,"contentRootPath":"content","siteUrl":"https://www.dotnetthailand.com"}},"mdx":{"fields":{"id":"efc7afcb-2c79-558b-a26b-8d5a7fc20d4e","title":"Docker compose for MySQL","slug":"/storage/mysql/docker-compose-for-mysql"},"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Docker compose for MySQL\",\n  \"showMetadata\": true,\n  \"editable\": true,\n  \"showToc\": true\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"section\", null, mdx(\"h1\", {\n    parentName: \"section\"\n  }, \"Files structure\"), mdx(\"ul\", {\n    parentName: \"section\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"List all files in this example.\")), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-shell\"\n  }, \"config/\\n- lower-case-table-names.cnf\\ninit/\\n- init-database.sql\\n- set-database-permission.sql\\n.env\\ndocker-compose.yml\\n\\n\"))), mdx(\"section\", null, mdx(\"h1\", {\n    parentName: \"section\"\n  }, \"docker-compose.yml\"), mdx(\"ul\", {\n    parentName: \"section\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Use MySQL latest version image with tag '8.0'\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Create additional database user\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Create docker secret files to be used for database passwords\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Configure health checking\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Use name volumes to not loss data when remove container\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Use initialize database script\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Use custom configuration to use lower case table name\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Use commands to set database character\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Create a bridge network name that can used by other containers\\nThis can be useful when using \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"docker run\"), \" to launch a container and attach a compose network.\")), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-YAML\"\n  }, \"version: '3.8'\\n\\nservices:\\n  mysql-server:\\n    container_name: mysql-server\\n    image: mysql:8.0\\n    restart: always\\n    environment:\\n      MYSQL_ROOT_PASSWORD_FILE: \\\"/run/secrets/mysql_root_password\\\"\\n      # Set permission of this user in \\\"set-database-permission.sql\\\"\\n      MYSQL_USER: my-user\\n      MYSQL_PASSWORD_FILE: \\\"/run/secrets/mysql_password\\\"\\n      MYSQL_DATABASE: my-database\\n\\n    ports:\\n      - 3306:3306\\n    secrets:\\n      - mysql_root_password\\n      - mysql_password\\n    healthcheck:\\n      test: mysqladmin ping -h localhost -u $$MYSQL_USER --password=$$(cat /run/secrets/mysql_password)\\n      timeout: 10s\\n      retries: 10\\n    volumes:\\n      # Use name volumes, managed by Docker for local development\\n      - mysql-data:/var/lib/mysql\\n      - mysql-logs:/var/log/mysql\\n\\n      # Map all files in init folder as initialize database files\\n      - ./init:/docker-entrypoint-initdb.d\\n\\n      # Using a custom MySQL configuration file\\n      - ./config:/etc/mysql/conf.d\\n    command:\\n      [\\n        --character-set-server=utf8mb4,\\n        --collation-server=utf8mb4_unicode_ci,\\n      ]\\n    networks:\\n      - compose_network\\n\\n# https://serverfault.com/questions/871090/how-to-use-docker-secrets-without-a-swarm-cluster\\nsecrets:\\n  mysql_root_password:\\n    file: ./mysql_root_password.txt\\n  mysql_password:\\n    file: ./mysql_password.txt\\n\\n# https://docs.docker.com/compose/compose-file/compose-file-v3/#external-1\\nvolumes:\\n  mysql-data:\\n  mysql-logs:\\n\\n# https://docs.docker.com/compose/compose-file/compose-file-v3/#network-configuration-reference\\n# Full document https://docs.docker.com/compose/networking/\\nnetworks:\\n  compose_network:\\n\"))), mdx(\"section\", null, mdx(\"h1\", {\n    parentName: \"section\"\n  }, \"docker secrets\"), mdx(\"ul\", {\n    parentName: \"section\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Create docker secret files to be used for database passwords\")), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-shell\"\n  }, \"echo \\\"MySQL1234\\\\!\\\" > mysql_root_password.txt\\necho \\\"pa\\\\$\\\\$w@rd\\\"  > mysql_password.txt\\n\"))), mdx(\"section\", null, mdx(\"h1\", {\n    parentName: \"section\"\n  }, \"lower-case-table-names.cnf\"), mdx(\"ul\", {\n    parentName: \"section\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Use lower case table name to prevent case sensitive problem on a Linux machine.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"More details \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://stackoverflow.com/a/6134059/1872200\"\n  }, \"https://stackoverflow.com/a/6134059/1872200\"), \".\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Server Command Options \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://stackoverflow.com/a/15453913/1872200\"\n  }, \"https://stackoverflow.com/a/15453913/1872200\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Alternatively, you can use command: \", \"[ --lower_case_table_names=1 ]\", \" in docker-compose.yml.\")), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"[mysqld]\\nlower_case_table_names=1\\n\\n\"))), mdx(\"section\", null, mdx(\"h1\", {\n    parentName: \"section\"\n  }, \"init-database.sql\"), mdx(\"ul\", {\n    parentName: \"section\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Create a new table.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Insert some data.\")), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-SQL\"\n  }, \"USE `my-database`;\\n\\nCREATE TABLE users (\\n  id INT NOT NULL AUTO_INCREMENT,\\n  first_name VARCHAR(50) NOT null,\\n  last_name VARCHAR(50) NOT NULL,\\n  date_of_birth DATETIME NOT NULL,\\n  PRIMARY KEY (`id`)\\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\\n\\nINSERT INTO users VALUES (NULL, 'Jose', 'Realman', '2018-01-01');\\n\\n\"))), mdx(\"section\", null, mdx(\"h1\", {\n    parentName: \"section\"\n  }, \"set-database-permission.sql\"), mdx(\"ul\", {\n    parentName: \"section\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Grant all permissions of database 'my-database' to user 'my-user' on a localhost server.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The user is created by defining in docker-compose.yml.\")), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-SQL\"\n  }, \"-- set-database-permission.sql\\nUSE mysql;\\n\\nGRANT ALL PRIVILEGES ON `my-database`.* TO 'my-user'@'%';\\n\\n\")), mdx(\"ul\", {\n    parentName: \"section\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"If you want to create a user manually, use the following command.\")), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-SQL\"\n  }, \"  CREATE USER 'my-user'@'localhost' IDENTIFIED BY 'the_secure_password';\\n\\n\"))), mdx(\"section\", null, mdx(\"h1\", {\n    parentName: \"section\"\n  }, \".env\"), mdx(\"ul\", {\n    parentName: \"section\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Explicit prefix volume/network name with this value or use -P with docker run\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"More details \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://docs.docker.com/compose/reference/envvars/#compose_project_name\"\n  }, \"https://docs.docker.com/compose/reference/envvars/#compose_project_name\"))), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-Shell\"\n  }, \"COMPOSE_PROJECT_NAME = my_project\\n\\n\"))), mdx(\"section\", null, mdx(\"h1\", {\n    parentName: \"section\"\n  }, \"Useful resources\"), mdx(\"ul\", {\n    parentName: \"section\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://hub.docker.com/_/mysql\"\n  }, \"My SQL Docker image on Docker hub\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://serverfault.com/questions/871090/how-to-use-docker-secrets-without-a-swarm-cluster\"\n  }, \"Manage sensitive data with Docker secrets\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://stackoverflow.com/a/30074553/1872200\"\n  }, \"What is the difference between utf8mb4 and utf8 charsets in MySQL?\")))));\n}\n;\nMDXContent.isMDXComponent = true;","tableOfContents":{"items":[{"url":"#files-structure","title":"Files structure"},{"url":"#docker-composeyml","title":"docker-compose.yml"},{"url":"#docker-secrets","title":"docker secrets"},{"url":"#lower-case-table-namescnf","title":"lower-case-table-names.cnf"},{"url":"#init-databasesql","title":"init-database.sql"},{"url":"#set-database-permissionsql","title":"set-database-permission.sql"},{"url":"#env","title":".env"},{"url":"#useful-resources","title":"Useful resources"}]},"timeToRead":1,"parent":{"__typename":"File","relativePath":"storage/mysql/docker-compose-for-mysql.md"},"frontmatter":{"metaTitle":null,"showMetadata":true,"editable":true,"showPreviousNext":null,"showToc":true}},"gitBranch":{"name":"main"},"gitCommit":{"hash":"d8cc45e74ec87b664a5c7f2ad7a707af6edac455","date":"2021-09-20 03:20"}},"pageContext":{"id":"efc7afcb-2c79-558b-a26b-8d5a7fc20d4e"}},"staticQueryHashes":["12478684","12478684","1306071104","2353585426","2353585426","2552263575","2552263575","2882937274","2882937274","353167761","353167761","3812332637","3812332637","4285724809"]}