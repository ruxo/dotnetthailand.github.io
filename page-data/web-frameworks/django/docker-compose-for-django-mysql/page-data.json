{"componentChunkName":"component---src-templates-docs-js","path":"/web-frameworks/django/docker-compose-for-django-mysql","result":{"data":{"site":{"siteMetadata":{"title":".NET Thailand","docsLocation":"https://github.com/dotnetthailand/dotnetthailand.github.io","docsRepo":"dotnetthailand/dotnetthailand.github.io","docsLocationType":"github","editable":true,"contentRootPath":"content","siteUrl":"https://www.dotnetthailand.com"}},"mdx":{"fields":{"id":"6183fde8-c564-56a7-be53-af6e0a0d6999","title":"Docker compose for Django and MySQL","slug":"/web-frameworks/django/docker-compose-for-django-mysql"},"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Docker compose for Django and MySQL\",\n  \"showMetadata\": true,\n  \"editable\": true,\n  \"showToc\": true\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"To use Django and MySQL Docker compose, we need to create these required files and add some contents to them.\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Dockerfile for a custom docker image\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"requirements.txt\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"docker-compose.yml\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \".env file\")), mdx(\"section\", null, mdx(\"h1\", {\n    parentName: \"section\"\n  }, \"Dockerfile\"), mdx(\"ul\", {\n    parentName: \"section\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"We create a Dockerfile for a custom a Django image.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Example content of \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"Dockerfile\"))), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"# Dockerfile\\nFROM python:3.9-alpine3.14\\n\\n# Set Python output is sent straight to terminal to see the output in realtime.\\nENV PYTHONUNBUFFERED=1\\n\\nWORKDIR /code\\nCOPY requirements.txt /code/\\nRUN pip install -r requirements.txt\\n\\n\"))), mdx(\"section\", null, mdx(\"h1\", {\n    parentName: \"section\"\n  }, \"requirements.txt\"), mdx(\"ul\", {\n    parentName: \"section\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"We use requirements.txt for installing all Python requirement.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Example content of \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"requirements.txt\"))), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-txt\"\n  }, \"Django>=3.0,<4.0\\nmysqlclient>=2.0.3\\n\\n\"))), mdx(\"section\", null, mdx(\"h1\", {\n    parentName: \"section\"\n  }, \"docker-compose.yml\"), mdx(\"ul\", {\n    parentName: \"section\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Example content of docker-compose.yml\")), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yml\"\n  }, \"# docker-compose.yml\\nversion: \\\"3.9\\\"\\n\\nservices:\\n  web:\\n    container_name: web\\n    build: .\\n    # TODO remove hard code sleep, it should use short sleep retry in entrypoint.sh\\n    command: bash -c \\\"sleep 15 && python manage.py runserver 0.0.0.0:8000\\\"\\n    volumes:\\n      - .:/code # mount current folder to /code folder in side a container\\n    ports:\\n      - 8000:8000\\n    depends_on:\\n      - db\\n    networks:\\n      - compose_network\\n\\n  db:\\n    container_name: mysql-server\\n    image: mysql:8.0\\n    restart: always\\n    environment:\\n      MYSQL_ROOT_PASSWORD_FILE: \\\"/run/secrets/mysql_root_password\\\"\\n      MYSQL_USER: my-user\\n      MYSQL_PASSWORD_FILE: \\\"/run/secrets/mysql_password\\\"\\n      MYSQL_DATABASE: my-db\\n    ports:\\n      - 3306:3306\\n    secrets:\\n      - mysql_root_password\\n      - mysql_password\\n    healthcheck:\\n      test: mysqladmin ping -h localhost -u $$MYSQL_USER --password=$$(cat /run/secrets/mysql_password)\\n      timeout: 10s\\n      retries: 10\\n    volumes:\\n      # Use name volumes, managed by Docker for local development\\n      - mysql-data:/var/lib/mysql\\n      - mysql-logs:/var/log/mysql\\n    command:\\n      [\\n        --character-set-server=utf8mb4,\\n        --collation-server=utf8mb4_unicode_ci,\\n        --lower-case-table-names=1,\\n        --default-authentication-plugin=mysql_native_password\\n      ]\\n    networks:\\n      - compose_network\\n\\n# https://docs.docker.com/compose/compose-file/compose-file-v3/#external-1\\nvolumes:\\n  mysql-data:\\n  mysql-logs:\\n\\n# https://serverfault.com/questions/871090/how-to-use-docker-secrets-without-a-swarm-cluster\\nsecrets:\\n  mysql_root_password:\\n    file: ./mysql_root_password.txt\\n  mysql_password:\\n    file: ./mysql_password.txt\\n\\nnetworks:\\n  compose_network:\\n\\n\"))), mdx(\"section\", null, mdx(\"h1\", {\n    parentName: \"section\"\n  }, \"docker secrets\"), mdx(\"ul\", {\n    parentName: \"section\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Create docker secret files to be used for database passwords\")), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-shell\"\n  }, \"echo \\\"MySQL1234\\\\!\\\" > mysql_root_password.txt\\necho \\\"pa\\\\$\\\\$w@rd\\\"  > mysql_password.txt\\n\"))), mdx(\"section\", null, mdx(\"h1\", {\n    parentName: \"section\"\n  }, \".env file\"), mdx(\"ul\", {\n    parentName: \"section\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Explicit prefix volume/network name with this value or use -P with docker run\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"More details \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://docs.docker.com/compose/reference/envvars/#compose_project_name\"\n  }, \"https://docs.docker.com/compose/reference/envvars/#compose_project_name\"))), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"# .env\\nCOMPOSE_PROJECT_NAME=django\\n\\n\"))), mdx(\"section\", null, mdx(\"h1\", {\n    parentName: \"section\"\n  }, \"File structure of our Django Docker compose\"), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"$ tree . -a\\n\\u251C\\u2500\\u2500 .env\\n\\u251C\\u2500\\u2500 Dockerfile\\n\\u251C\\u2500\\u2500 docker-compose.yml\\n\\u2514\\u2500\\u2500 requirements.txt\\n\\n\"))), mdx(\"section\", null, mdx(\"h1\", {\n    parentName: \"section\"\n  }, \"Create a new Django project\"), mdx(\"ul\", {\n    parentName: \"section\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"CD to the root of the project where we have docker-compose.yml file.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Launch a web container and run \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"django-admin\"), \" to create a new Django project by running the following commands:\")), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"$ projectName=my_django_site\\n$ docker-compose run web django-admin startproject $projectName . // docker compose run if you use compose v2\\n\\n\")), mdx(\"ul\", {\n    parentName: \"section\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"This will create a new Django project to a current working directory\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Optionally, you can change a project name to any name that you like.\"))), mdx(\"section\", null, mdx(\"h1\", {\n    parentName: \"section\"\n  }, \"Change files permission\"), mdx(\"ul\", {\n    parentName: \"section\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"At the root of project, execute the following command.\")), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"$ sudo chown -R $USER:$USER .\\n\")), mdx(\"ul\", {\n    parentName: \"section\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Then checking files permission to make sure that the current user must have ownership of all files.\")), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"$ ls -l\\n\"))), mdx(\"section\", null, mdx(\"h1\", {\n    parentName: \"section\"\n  }, \"Update a database connection\"), mdx(\"ul\", {\n    parentName: \"section\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Open \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"my_django_site/settings.py\"), \" file with your text editor.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Update \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"DATABASES\"), \" as the following:.\")), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"# my-django-site/settings.py\\nDATABASES = {\\n    'default': {\\n        'ENGINE': 'django.db.backends.mysql',\\n        'HOST': 'db',\\n        'PORT': 3306,\\n        'NAME': 'my-db',\\n        'USER': 'my-user',\\n        'PASSWORD': 'pass@rd',\\n    }\\n}\\n\\n\"))), mdx(\"section\", null, mdx(\"h1\", {\n    parentName: \"section\"\n  }, \"Launch a website\"), mdx(\"ul\", {\n    parentName: \"section\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Run the following command to launch web and db containers.\")), mdx(\"pre\", {\n    parentName: \"section\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"$ docker-compose up # docker compose up if you use compose v2\\n\")), mdx(\"ul\", {\n    parentName: \"section\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Open a browser and navigate to http://localhost:8000\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"You should find a welcome page of Django site.\\n\", mdx(\"span\", {\n    parentName: \"li\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"768px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/b5072a98d63d76b6d7044c1f4ac0f5e3/e5715/django-welcome-page.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"74.90347490347492%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABP0lEQVQ4y5VU226DMAzl/39w2rSnNkC30nBJSMIlnNpBZbSDAhaWIztYxz52ospqxPIXfhjAMpDdUpa+71FphVxXULWG1hpd1yHqKGAbtyvRk3qPlhI0XRsSsXryRdiSIXwT+i2JVst6OtNNPwQzbLRmQjjvz2u/vtUVX8VPOPuX2PwcEP6rcBb0fkT3KVN8XAU5MJG31oJFhI8m17XF9VbAGQejDTJZEpsGbTsS8RbhPGCtxeVygRACSZIgjmOcxBmn5AwRC6RpCmPMsZKbpoFSilDWqGnG2OZVGWaOER4qec94rJKytgl7tmVxbI7+8M6/2ENsbMU7f0DI+6etQVErVEajNAqubUZiyLKPleN28reTn5Xv/5VMw8vMZaWErArcyhzG2fCjI6ZlWQR2s0JSQjdNwOMuW351+PVhuQOKe58ZULhZxAAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"django welcome page\",\n    \"title\": \"django welcome page\",\n    \"src\": \"/static/b5072a98d63d76b6d7044c1f4ac0f5e3/e5715/django-welcome-page.png\",\n    \"srcSet\": [\"/static/b5072a98d63d76b6d7044c1f4ac0f5e3/a2ead/django-welcome-page.png 259w\", \"/static/b5072a98d63d76b6d7044c1f4ac0f5e3/6b9fd/django-welcome-page.png 518w\", \"/static/b5072a98d63d76b6d7044c1f4ac0f5e3/e5715/django-welcome-page.png 768w\"],\n    \"sizes\": \"(max-width: 768px) 100vw, 768px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n  \"), \"\\n    \")))), mdx(\"section\", null, mdx(\"h1\", {\n    parentName: \"section\"\n  }, \"Stop and remove containers\"), mdx(\"ul\", {\n    parentName: \"section\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"To stop containers, press \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"ctrl + c\"), \".\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"To remove containers and all volumes, run \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"docker-compose down ---volumes or docker compose down ---volumes if you use compose v2\")))), mdx(\"section\", null, mdx(\"h1\", {\n    parentName: \"section\"\n  }, \"Useful resources\"), mdx(\"ul\", {\n    parentName: \"section\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://github.com/docker/compose-cli\"\n  }, \"Compose v2\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://docs.docker.com/samples/django/\"\n  }, \"Quickstart: Compose and Django\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://stackoverflow.com/a/59812588/1872200\"\n  }, \"What is the use of PYTHONUNBUFFERED in docker file?\")))));\n}\n;\nMDXContent.isMDXComponent = true;","tableOfContents":{"items":[{"url":"#dockerfile","title":"Dockerfile"},{"url":"#requirementstxt","title":"requirements.txt"},{"url":"#docker-composeyml","title":"docker-compose.yml"},{"url":"#docker-secrets","title":"docker secrets"},{"url":"#env-file","title":".env file"},{"url":"#file-structure-of-our-django-docker-compose","title":"File structure of our Django Docker compose"},{"url":"#create-a-new-django-project","title":"Create a new Django project"},{"url":"#change-files-permission","title":"Change files permission"},{"url":"#update-a-database-connection","title":"Update a database connection"},{"url":"#launch-a-website","title":"Launch a website"},{"url":"#stop-and-remove-containers","title":"Stop and remove containers"},{"url":"#useful-resources","title":"Useful resources"}]},"timeToRead":1,"parent":{"__typename":"File","relativePath":"web-frameworks/django/docker-compose-for-django-mysql.md"},"frontmatter":{"metaTitle":null,"showMetadata":true,"editable":true,"showPreviousNext":null,"showToc":true}},"gitBranch":{"name":"main"},"gitCommit":{"hash":"d8cc45e74ec87b664a5c7f2ad7a707af6edac455","date":"2021-09-20 03:20"}},"pageContext":{"id":"6183fde8-c564-56a7-be53-af6e0a0d6999"}},"staticQueryHashes":["12478684","12478684","1306071104","2353585426","2353585426","2552263575","2552263575","2882937274","2882937274","353167761","353167761","3812332637","3812332637","4285724809"]}